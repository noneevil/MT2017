var Overlay=new Class({Implements:[Options,Events],getOptions:function(){return{useFx:false,name:"",duration:200,colour:"#000",opacity:0.2,zIndex:99,hasShim:true,container:document.body,onClick:$empty}},initialize:function(a){this.setOptions(this.getOptions(),a);this.options.container=$(this.options.container);this.container=new Element("div").setProperty("id",this.options.name+"_overlay").setStyles({position:"absolute",left:"0",top:"0",width:"100%",height:"100%",backgroundColor:this.options.colour,zIndex:this.options.zIndex,opacity:this.options.opacity}).inject(this.options.container);this.options.useFx?this.fade=new Fx.Tween(this.container,{property:"opacity",duration:this.options.duration}).set(0):this.fade=null;this.container.setStyle("display","none");this.container.addEvent("click",function(){this.fireEvent("click")}.bind(this));window.addEvent("resize",this.position.bind(this));return this.position()},position:function(){if(this.options.container==document.body){var a=window.getScrollHeight()+"px";this.container.setStyles({top:"0px",height:a})}else{var b=this.options.container.getCoordinates();this.container.setStyles({top:b.top+"px",height:b.height+"px",left:b.left+"px",width:b.width+"px"})}},show:function(){this.container.setStyle("display","");if(this.fade){this.fade.cancel().start(this.options.opacity)}return this.position()},hide:function(a){if(this.fade){this.fade.cancel().start(0)}this.container.setStyle("display","none");if(a){this.dispose()}return this},dispose:function(){this.container.dispose()}});var Mbox={presets:{marginImage:{x:50,y:75},width:"auto",height:"auto",url:false,type:"ele",ajax:false,ajaxAttr:"href",ajaxOptions:{},title:"提示框",ensure:"确定",cancel:"取消",clostxt:"×",loadimg:"http://s1.95171.cn/adentity/images/o_loading.gif",overlay:true,opacity:0.35,overlayClosable:false,reposition:true,closable:true,titleable:true,optable:false,zIndex:999,time:0,useFx:false,openFrom:null,resizeFx:{},onShow:$empty,onClose:$empty},initialize:function(a){this.options={};this.setOptions(this.presets,a||{});this.build();this.bound={window:this.reposition.bind(this,[null]),close:this.close.bind(this),key:this.onKey.bind(this)};this.isOpen=this.elementObj=false;this.ie6=(window.XMLHttpRequest)?false:true;return this},build:function(){if(!this.overlay){this.overlay=new Overlay({name:"mbox",opacity:this.options.opacity,onClick:(this.options.overlayClosable)?this.close.bind(this):null})}if(!$("mboxWindow")){var d='<div id="mboxBar" class="mbox_bar">'+this.options.title+'</div><a href="javascript:;" id="mboxBtnClose" class="mbox_close" title="关闭">'+this.options.clostxt+'</a><div id="mboxContent" class="mbox_cont"></div><div id="mboxOperate" class="mbox_operate" style="display:none;"></div>';var e=this.options.openFrom,c,b,a;if($type(e)==="element"&&e){c=e.getPosition().y,a=e.getPosition().x,b=e.getSize().x}else{c=250,b=400,a=(window.getSize().x-b)/2}this.win=new Element("div",{id:"mboxWindow","class":"mbox_win",styles:{width:b,top:c,left:a,position:"absolute",zIndex:this.options.zIndex+2,visibility:"hidden"}}).set("html",d);document.body.adopt(this.win)}this.bar=$("mboxBar");this.closbtn=$("mboxBtnClose");this.cont=$("mboxContent");this.opt=$("mboxOperate");return this},assign:function(b,a){b.addEvent("click",function(c){new Event(c).stop();Mbox.open(a,this)})},open:function(a,b){a=a||{},this.initialize(a);if($type(b)==="element"){this.element=$(b);this.options.url=this.element.getProperty(this.options.ajaxAttr)||this.options.url}this.getContent()},remind:function(b,a){if(b){this.initParams();a=a||{};this.initialize(a);this.getContent('<div class="mbox_remind">'+b+"</div>");this.closbtn.setStyle("visibility","hidden");this.bar.setStyle("display","none");this.opt.setStyle("display","none");var c=this.options.time.toInt();if(c>0){this.close.delay(c,this)}}return this},alert:function(c,b,a){if(!c){return this}this.initParams();a=a||{};this.initialize(a);this.getContent('<div class="mbox_alert">'+c+"</div>");this.opt.setStyle("display","block");this.bar.setStyle("display","block");this.AlertBtnOk=new Element("input",{id:"mboxAlertOk","class":"mbox_btn_sure",type:"submit",value:this.options.ensure});this.AlertBtnOk.addEvent("click",function(){this.close();if($type(b)==="function"){b.call(this)}}.bind(this));this.opt.empty().adopt(this.AlertBtnOk);if($("mboxAlertOk")&&$("mboxAlertOk").isDisplayed){$("mboxAlertOk").focus()}},confirm:function(d,c,b,a){if(!d){return this}this.initParams();a=a||{};this.initialize(a);this.getContent('<div class="mbox_alert">'+d+"</div>");this.opt.setStyle("display","block");this.bar.setStyle("display","block");this.ConfirmBtnOk=new Element("input",{id:"mboxConfirmOk","class":"mbox_btn_sure",type:"submit",value:this.options.ensure});this.ConfirmBtnCancel=new Element("input",{id:"mboxConfirmCancel","class":"mbox_btn_cancel",type:"button",value:this.options.cancel});this.opt.empty().adopt(this.ConfirmBtnOk,this.ConfirmBtnCancel);this.ConfirmBtnOk.addEvent("click",function(){if($type(c)==="function"){c.call(this)}}.bind(this));this.ConfirmBtnCancel.addEvent("click",function(){this.close();if($type(b)==="function"){c.call(this)}}.bind(this));if($("mboxConfirmOk")&&$("mboxConfirmOk").isDisplayed){$("mboxConfirmOk").focus()}},loading:function(a){this.initialize({});a=a||'<div class="mbox_loading"><img src="'+this.options.loadimg+'" class="mbox_loading_image" />加载中...</div>';this.getContent(a);this.closbtn.setStyle("visibility","hidden");this.bar.setStyle("display","none");this.opt.setStyle("display","none");return this},close:function(){if(this.isOpen){this.isOpen=false;if($type(this.options.onClose)==="function"){this.options.onClose.call(this)}if(this.overlay&&this.options.overlay){this.overlay.dispose();this.overlay=null}if(this.ie6){$$("select").setStyle("visibility","visible")}if(this.elementObj){document.body.adopt(this.elementObj.setStyle("display","none"))}this.cont.empty();this.opt.empty();this.win.setStyle("visibility","hidden");this.closbtn.setStyle("visibility","hidden");if(this.element){this.element=null}this.initParams();this.toggleListeners();this.options.onShow=$empty;this.options.onClose=$empty;if(this.fx){this.fx=null}}return false},initParams:function(){this.options={};this.setOptions(this.presets)},toggleListeners:function(b){var a=(b)?"addEvent":"removeEvent";this.closbtn[a]("click",this.bound.close);document[a]("keydown",this.bound.key);if(this.options.reposition){window[a]("resize",this.bound.window)[a]("scroll",this.bound.window)}},getContent:function(e){this.toggleListeners(true);if(e){return this.applyContent(e)}var f=this.options.type,a=this.options.url,d=this.options;if(!a){return false}if(this.options.ajax){this.loading();this.options=d;var h=this.options.width.toInt()||600,g=this.options.height.toInt()||400;switch(f){case"image":var c=new Image(),i=a;c.onload=function(){var m=document.getSize(),l;m.x-=this.options.marginImage.x;m.y-=this.options.marginImage.y;l={x:c.width,y:c.height};for(var k=2;k--;){if(l.x>m.x){l.y*=m.x/l.x;l.x=m.x}else{if(l.y>m.y){l.x*=m.y/l.y;l.y=m.y}}}l.x=l.x.toInt();l.y=l.y.toInt();this.applyContent('<img class="mbox_ajax_image" src="'+i+'" width="'+l.x+'" height="'+l.y+'" />')}.bind(this);c.onerror=function(){this.alert("图片加载没有成功！")}.bind(this);c.src=i;break;case"iframe":var b={src:a,styles:{width:h,height:g,background:"url("+this.options.loadimg+") no-repeat center",border:0},"class":"mbox_ajax_iframe",frameborder:0};this.applyContent(new IFrame(b));break;case"ajax":new Request.HTML($merge({method:"get"},$extend({evalScripts:false},this.options.ajaxOptions))).addEvents({onFailure:this.onError.bind(this),onComplete:function(l,k,n,m){this.applyContent(n,m)}.bind(this)}).send({url:a});break;case"swf":var j='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="'+h+'" height="'+g+'" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="quality" value="high" /><param name="src" value="'+a+'" /><param name="wmode" value="transparent" /><embed type="application/x-shockwave-flash" wmode="transparent" width="'+h+'" height="'+g+'" src="'+a+'" quality="high"></embed></object>';this.applyContent(j);break;default:return this.applyContent(a)}}else{if($type(a)==="string"){a=a.replace(/^#/,"");if($(a)){a=$(a)}}return this.applyContent(a)}},applyContent:function(content,js){var position=this.cont.getStyle("position");if($type(content)==="string"){this.cont.set("html",content).setStyle("position","absolute")}else{if($type(content)==="element"){this.elementObj=content;this.cont.empty().adopt(content.setStyle("display","block")).setStyle("position","absolute")}else{return this}}if(js){eval(js)}this.winsize=this.cont.getSize();this.cont.setStyle("position",position);this.bar.set("html",this.options.title);this.closbtn.set("html",this.options.clostxt);this.showControl();this.reposition();this.win.setStyle("visibility","visible");this.isOpen=true;if(this.ie6){$$("select").setStyle("visibility","hidden")}if($type(this.options.onShow)==="function"){this.options.onShow.call(this)}return this},showControl:function(){if(this.options.closable){this.closbtn.setStyle("visibility","visible")}else{this.closbtn.setStyle("visibility","hidden")}if(this.overlay&&this.options.overlay){this.overlay.show()}if(this.options.titleable){this.bar.setStyle("display","block")}else{this.bar.setStyle("display","none")}if(this.options.optable){this.opt.setStyle("display","block")}else{this.opt.setStyle("display","none")}},reposition:function(e){var l=document,m=window.getSize();var f=this.winsize?this.winsize.x:this.win.getSize().x,b=this.win.getScrollSize().y,k=m.x,i=m.y,j=l.getScroll().y,n=b<i,a,q,p=this.options.width.toInt(),g=this.options.height.toInt();b=g||b,f=p||f;this.win.setStyle("height",b);a=(k-f)/2;q=(i-b)/2+j;if(this.ie6||!this.options.reposition){q=n?((i-b)/2+j):(50+j);this.win.setStyle("position","absolute")}else{q=n?((i-b)/2):50;this.win.setStyle("position","fixed")}var o={width:f,height:b,left:a,top:q};if(this.options.useFx||e===true){this.fx={win:new Fx.Morph(this.win,$merge({duration:750,transition:Fx.Transitions.Quint.easeOut,link:"cancel",unit:"px",onComplete:function(){if(!g){this.win.setStyle("height","auto")}}.bind(this)},this.options.resizeFx))}}if(this.fx&&!this.ie6){this.fx.win.cancel().start(o)}else{this.win.setStyles(o);if(!g){this.win.setStyle("height","auto")}}},onError:function(){this.alert("加载出了点小问题。")},onKey:function(a){switch(a.key){case"esc":if(this.closbtn.css("visibility")==="visible"){this.close(a)}case"up":case"down":return false}},extend:function(a){return $extend(this,a)}};Mbox.extend(new Options);